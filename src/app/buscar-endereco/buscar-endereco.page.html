<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
    <ion-title>Buscar Endereço</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <!-- Card de Busca de CEP -->
  <ion-card class="ion-margin-bottom">
    <ion-card-header>
      <ion-card-title>Digite o CEP</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label position="stacked">CEP (somente números)</ion-label>
        <ion-input
          type="tel"
          maxlength="8"
          placeholder="Ex: 23015030"
          [(ngModel)]="cep"
          (keyup.enter)="searchCep()"
          [disabled]="isLoading"
        ></ion-input>
      </ion-item>

      <ion-button 
        expand="block" 
        class="ion-margin-top"
        (click)="searchCep()" 
        [disabled]="cep.length !== 8 || isLoading"
        color="secondary"
      >
        <ion-icon name="search-outline" slot="start"></ion-icon>
        BUSCAR CEP
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Loading Indicator -->
  <ion-loading [isOpen]="isLoading" message="Buscando endereço e coordenadas..."></ion-loading>

  <!-- Card de Resultado (Endereço Encontrado) -->
  <ion-card *ngIf="address">
    <ion-card-header [color]="coordinates ? 'success' : 'warning'">
      <ion-card-title class="ion-text-center">
        Endereço Encontrado!
      </ion-card-title>
    </ion-card-header>
    <ion-card-content class="ion-padding-top">
      
      <!-- Detalhes do Endereço -->
      <ion-item lines="none">
        <ion-label>CEP:</ion-label>
        <ion-text slot="end">{{ address.cep | slice:0:5 }}-{{ address.cep | slice:5 }}</ion-text>
      </ion-item>
      <ion-item lines="none">
        <ion-label>Rua:</ion-label>
        <ion-text slot="end">{{ address.logradouro }}</ion-text>
      </ion-item>
      <ion-item lines="none">
        <ion-label>Bairro:</ion-label>
        <ion-text slot="end">{{ address.bairro }}</ion-text>
      </ion-item>
      <ion-item lines="none">
        <ion-label>Cidade/UF:</ion-label>
        <ion-text slot="end">{{ address.localidade }} / {{ address.uf }}</ion-text>
      </ion-item>


      
      <!-- Botão para Salvar Endereço (Firestore) -->
      <ion-button 
        expand="block" 
        class="ion-margin-top" 
        (click)="saveAddress()"
        color="dark"
        [disabled]="isLoading"
      >
        <ion-icon name="save-outline" slot="start"></ion-icon>
        SALVAR ENDEREÇO
      </ion-button>

    </ion-card-content>
  </ion-card>

  <!-- Mensagem de erro de CEP não encontrado -->
  <ion-card *ngIf="address === null && !isLoading && cep.length === 8">
    <ion-card-header color="danger">
      <ion-card-title class="ion-text-center">
        CEP Não Encontrado
      </ion-card-title>
    </ion-card-header>
  </ion-card>

</ion-content>